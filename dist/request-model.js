!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["request-model"]=e():t["request-model"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=1)}([function(t,e,i){"use strict";const s=(()=>{const t="__REQUEST__MODEL__COMMIT__TOKEN";return Symbol?Symbol(t):t})();e.a=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(2);e.default=s.a},function(t,e,i){"use strict";var s=i(0),n=i(3);const r={promiseWrap:!1},o=(t,e)=>t?(...t)=>new Promise((i,s)=>{e.call(null,i,s,...t)}):e;e.a=class{constructor(t){this.requestConfig=t,this.setting=this.getRequestConfig(),this.action=this.requestConfig.action,this.requestFormat()}chain(){return new n.a(this.request,this.action)}commitWrap(t,...e){return{[s.a]:!0,key:t,args:[...e]}}commitAll(t){return t.map(t=>({[s.a]:!0,key:t.key,args:[...t.args]}))}requestFormat(){const t={},e=Object.keys.call(null,this.requestConfig.request||{}),i=Object.keys.call(null,this.requestConfig.modules||{});for(const i of e)t[i]=o(this.setting.config.promiseWrap,this.requestConfig.request[i]);for(const e of i){const i={},s=Object.keys.call(null,this.requestConfig.modules[e].request||{});for(const t of s)i[t]=o(this.setting.modules[e].promiseWrap,this.requestConfig.modules[e].request[t]);t[e]=i}this.request=t}getRequestConfig(){const t={config:r,modules:{}},e=Object.keys.call(null,this.requestConfig.config||{}),i=Object.keys.call(null,this.requestConfig.modules||{});e.map(e=>{t.config[e]=this.requestConfig.config[e]});for(const e of i){t.modules[e]=Object.assign({},t.config);const i=Object.keys.call(null,this.requestConfig.modules[e].config||{});for(const s of i)t.modules[e][s]=this.requestConfig.modules[e].config[s]}return t}}},function(t,e,i){"use strict";var s=i(0),n=i(4),r=i(5);function o(t){return void 0!==t.key}const c=t=>!!Object(n.b)(t)&&"handler"in t,u=t=>c(t)?t.handler:t,l=(t,e)=>Object(n.a)(t)?t.filter(t=>!!Object(r.a)(u(t),e)).length===t.length:!!Object(r.a)(t,e),h=(t,e,i)=>t.map(t=>Object(r.a)(u(t),e)(...(t=>c(t)?t.args:[])(t),...i));e.a=class{constructor(t,e){this.request=t,this.resultList=[],this.waitList=[],this.actionFun=e}commit(t,...e){if(this.unResolveRejection)return this;if(!l(t,this.request))throw new Error(`can not find matched ${t} function`);if(this.deferItem)this.waitList.push({key:t,args:e});else{let i;if(i=Object(n.a)(t)?Promise.all(h(t,this.request,[...e])):Object(r.a)(t,this.request)(...e),!Object(n.c)(i))throw new Error(`The ${t} function not return a Promise function`);this.deferItem=i,this.deferItem.then(t=>{this.commitChain(t)},t=>{this.innerRejection(t)})}return this}then(t,e){return this.deferItem?this.waitList.push({resolve:t,reject:e}):this.innerResolve({resolve:t,reject:e}),this}finish(t,e){return this.waitList.length||this.deferItem?(this.resolve=t,this.reject=e):this.innerResolve({resolve:t,reject:e}),this}catch(t){const e=()=>{};return this.waitList.length||this.deferItem?this.reject=t:this.innerResolve({resolve:e,reject:t}),this}action(t,...e){return this.actionFun[t].call(null,this,...e)}commitChain(t){if(this.resultList.push(t),this.waitList.length){const e=this.waitList.shift();this.deferItem=null,o(e)?this.commit(e.key,...e.args,t):this.innerResolve(e,t)}else this.resolve&&this.resolve(this.resultList)}innerResolve(t,e){let i;if(this.unResolveRejection)return t.reject?(t.reject(this.unResolveRejection),this.unResolveRejection=null):this.innerRejection(this.unResolveRejection)&&(this.unResolveRejection=null),this;try{i=t.resolve(e)}catch(t){return this.innerRejection(t)||(this.unResolveRejection=t),this}if(Object(n.c)(i))this.deferItem=i,i.then(t=>{this.commitChain(t)},t=>{this.innerRejection(t)});else if(Object(n.a)(i)){const t=i.map(t=>({handler:t.key,args:t.args}));this.commit(t)}else void 0!==i&&i[s.a]?this.commit(i.key,...i.args):this.commitChain(i);return this}innerRejection(t,e){let i;if(this.waitList.length){let t=0;for(let e=0;e<this.waitList.length;e+=1)if(!o(this.waitList[e])&&this.waitList[e].reject){i=this.waitList[e].reject,t=e;break}this.waitList.splice(0,t)}return!i&&this.reject&&(i=this.reject),!!i&&(e&&e(),this.deferItem=null,i(t),!0)}}},function(t,e,i){"use strict";e.a=(t=>"[object Array]"===Object.prototype.toString.call(t));e.b=(t=>"[object Object]"===Object.prototype.toString.call(t));e.c=(t=>{try{return"function"==typeof t.then}catch(t){return!1}})},function(t,e,i){"use strict";e.a=((t,e)=>{let i=e;-1!==t.indexOf("/")?t.split("/").map(t=>{i instanceof Function||(i=i[t])}):i=i[t];if(i instanceof Function)return i})}])});
//# sourceMappingURL=request-model.js.map
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["request-model"]=e():t["request-model"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/",s(s.s=3)}([function(t,e,s){"use strict";const i=(()=>{const t="__REQUEST__MODEL__COMMIT__TOKEN";return Symbol?Symbol(t):t})();e.a=i},function(t,e,s){"use strict";var i=s(0),n=s(2),r=s(5);function o(t){return void 0!==t.key}const c=t=>!!Object(n.d)(t)&&"handler"in t,l=t=>c(t)?t.handler:t,a=(t,e)=>{if(Object(n.b)(t)){const s=t.filter(t=>!Object(r.a)(l(t),e));return s.length?s.map(t=>t.handler?t.handler:t).join(","):""}return Object(r.a)(t,e)?"":t},u=(t,e,s)=>t.map(t=>Object(r.a)(l(t),e)(...(t=>c(t)?t.args:[])(t),...s)),h=()=>{};e.a=class{constructor(t,e){this.request=t,this.resultList=[],this.waitList=[],this.actionFun=e}commit(t,...e){if(this.unResolveRejection)return this;const s=a(t,this.request);if(s)throw new Error(`can not find matched commit key: ${s}`);if(this.deferItem)this.waitList.push({key:t,args:e});else{let s;if(s=Object(n.b)(t)?Promise.all(u(t,this.request,[...e])):Object(r.a)(t,this.request)(...e),!Object(n.e)(s))throw new Error(`The ${t} function not return a Promise function`);this.deferItem=s,this.deferItem.then(t=>{this.commitChain(t)},t=>{this.innerRejection(t)})}return this}then(t,e,s,i){return this.deferItem?this.waitList.push({resolve:t,reject:e,always:s,before:i}):this.innerResolve({resolve:t,reject:e,always:s,before:i}),this}finish(t,e,s){return this.waitList.length||this.deferItem?(this.resolve=t,this.reject=e||this.reject):this.innerResolve({resolve:t,reject:e,always:s}),this}finally(t,e,s){return this.finish(t,e,s)}catch(t){return this.waitList.length||this.deferItem?this.reject=t:this.innerResolve({resolve:h,reject:t}),this}always(t){return this.alwaysFn=t,this}action(t,...e){return this.actionFun[t].call(null,this,...e)}commitChain(t){if(this.resultList.push(t),this.waitList.length){const e=this.waitList.shift();this.deferItem=null,o(e)?this.commit(e.key,...e.args,t):this.innerResolve(e,t)}else this.resolve&&this.resolve(this.resultList),this.innerAlways()}innerResolve(t,e){let s;if(this.unResolveRejection)return t.reject?(t.before&&t.before(),t.reject(this.unResolveRejection),t.always&&t.always(),this.unResolveRejection=null):this.innerRejection(this.unResolveRejection,t.always)&&(this.unResolveRejection=null),this;try{t.before&&t.before(),s=t.resolve(e),t.always&&t.always()}catch(e){return this.innerRejection(e,t.always)||(this.unResolveRejection=e),this}if(Object(n.e)(s))this.deferItem=s,s.then(t=>{this.commitChain(t)},t=>{this.innerRejection(t,s.always)});else if(Object(n.b)(s)){const t=s.map(t=>({handler:t.key,args:t.args}));this.commit(t)}else void 0!==s&&s[i.a]?this.commit(s.key,...s.args):this.commitChain(s);return this}innerRejection(t,e){let s,i=e;if(this.waitList.length){let t=0;for(let e=0;e<this.waitList.length;e+=1)if(!o(this.waitList[e])&&this.waitList[e].reject){s=this.waitList[e].reject,i=this.waitList[e].always,t=e;break}this.waitList.splice(0,t)}return!s&&this.reject&&(s=this.reject),s?(this.deferItem=null,s(t),i&&i(),this.innerAlways(),!0):(this.innerAlways(),!1)}innerAlways(){this.alwaysFn&&this.alwaysFn()}}},function(t,e,s){"use strict";e.b=(t=>"[object Array]"===Object.prototype.toString.call(t));e.d=(t=>"[object Object]"===Object.prototype.toString.call(t));e.c=(t=>"[object Function]"===Object.prototype.toString.call(t));e.e=(t=>{try{return"function"==typeof t.then}catch(t){return!1}});e.a=(t=>{const e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:""})},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(4);e.default=i.a},function(t,e,s){"use strict";var i=s(0),n=s(1),r=s(6);const o={promiseWrap:!1},c=(t,e)=>t?(...t)=>new Promise((s,i)=>{e.call(null,s,i,...t)}):e;e.a=class{constructor(t){this.requestConfig=t,this.setting=this.getRequestConfig(),this.actionCollection=this.requestConfig.action,this.requestFormat()}static PROMISEWRAP(t){return c(!0,t)}chain(){return new n.a(this.request,this.actionCollection)}collection(){return new r.a}add(){}commit(...t){const e=this.chain();return e.commit.apply(e,t)}action(...t){const e=this.chain();return e.action.apply(e,t)}then(...t){const e=this.chain();return e.then.apply(e,t)}finish(...t){const e=this.chain();return e.finish.apply(e,t)}catch(...t){const e=this.chain();return e.catch.apply(e,t)}always(...t){const e=this.chain();return e.always.apply(e,t)}finally(...t){const e=this.chain();return e.finally.apply(e,t)}commitWrap(t,...e){return{[i.a]:!0,key:t,args:[...e]}}commitAll(t){return t.map(t=>({[i.a]:!0,key:t.key,args:[...t.args]}))}requestFormat(){const t={request:{},modules:{}},e=Object.keys.call(null,this.requestConfig.request||{}),s=Object.keys.call(null,this.requestConfig.modules||{});for(const s of e)t.request[s]=c(this.setting.config.promiseWrap,this.requestConfig.request[s]);const i=(t,e,s,n)=>{for(const r of t){const t={request:{},modules:{}},o=Object.keys.call(null,s[r].request||{});for(const i of o)t.request[i]=c(e.modules[r].config.promiseWrap,s[r].request[i]);n.modules[r]=t;const l=Object.keys.call(null,s[r].modules||{});l.length&&i(l,e.modules[r],s[r].modules,n.modules[r])}};i(s,this.setting,this.requestConfig.modules,t),this.request=t}getRequestConfig(){const t={config:o,modules:{}},e=Object.keys.call(null,this.requestConfig.config||{}),s=Object.keys.call(null,this.requestConfig.modules||{});e.map(e=>{t.config[e]=this.requestConfig.config[e]});const i=(t,e,s)=>{for(const n of t){s.modules[n]={config:Object.assign({},s.config),modules:{}};const t=Object.keys.call(null,e[n].config||{});for(const i of t)s.modules[n].config[i]=e[n].config[i];const r=Object.keys.call(null,e[n].modules||{});r.length&&i(r,e[n].modules,s.modules[n])}};return i(s,this.requestConfig.modules,t),t}}},function(t,e,s){"use strict";e.a=((t,e)=>{let s,i=e;try{if(-1!==t.indexOf("/")){const e=t.split("/");e.map((t,n)=>{n!==e.length-1?i=i.modules[t]:s=i.request[t]})}else s=i.request[t]}catch(t){}return s})},function(t,e,s){"use strict";var i=s(2),n=s(1);e.a=class extends n.a{constructor(){super({request:{},modules:{}},{})}add(t,e){if(!Object(i.c)(t))throw new Error("The input must be a Function.");if(!Object(i.a)(t)&&!e)throw new Error("The input function must have a name.");const s=e||Object(i.a)(t);return this.request.request[s]=t,this}}}])});
//# sourceMappingURL=request-model.js.map
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["request-model"]=e():t["request-model"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=1)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.commitToken=(()=>{const t="__REQUEST__MODEL__COMMIT__TOKEN";return Symbol?Symbol(t):t})()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(2),r=i.n(s);e.default=r.a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(3);e.default=class{constructor(t){this.requestConfig=t,this.requestFormat()}chain(){return new r.default(this)}commitWrap(t,...e){return{[s.commitToken]:!0,key:t,args:[...e]}}requestFormat(){const t={};for(const e in this.requestConfig.request)t[e]=this.requestConfig.request[e];for(const e in this.requestConfig.modules){const i={};for(const t in this.requestConfig.modules[e].request)i[t]=this.requestConfig.modules[e].request[t];t[e]=i}this.request=t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=i(4),n=i(5),o=t=>!!r.isObject(t)&&"handler"in t,u=t=>o(t)?t.handler:t,c=(t,e)=>r.isArray(t)?t.filter(t=>!!n.getFunctionInRequest(u(t),e)).length===t.length:!!n.getFunctionInRequest(t,e),f=(t,e,i)=>t.map(t=>n.getFunctionInRequest(u(t),e)(...(t=>o(t)?t.args:[])(t),...i));e.default=class{constructor(t){this.request=t,this.resultList=[],this.waitList=[]}commit(t,...e){if(!c(t,this.request))throw new Error(`can not find matched ${t} function`);if(this.deferItem)this.waitList.push({key:t,args:e});else{let i;if(i=r.isArray(t)?Promise.all(f(t,this.request,[...e])):n.getFunctionInRequest(t,this.request)(...e),!r.isPromise(i))throw new Error(`The ${t} function not return a Promise function`);this.deferItem=i,this.deferItem.then(t=>{this.commitChain(t)},t=>{this.reject&&(this.deferItem=null,this.reject(t))})}return this}then(t,e){return this.waitList.push({resolve:t,reject:e}),this}finish(t,e){return this.resolve=t,this.reject=e,this}catch(t){return this.reject=t,this}commitChain(t){if(this.resultList.push(t),this.waitList.length){const e=this.waitList.shift();this.deferItem=null,"key"in e?this.commit(e.key,...e.args,t):this.innerResolve(e,t)}else this.resolve&&this.resolve(this.resultList)}innerResolve(t,e){const i=t.resolve(e);return r.isPromise(i)?i.then(t=>{this.commitChain(t)},t=>{this.reject&&this.reject(t)}):i[s.commitToken]?this.commit(i.key,...i.args):this.commitChain(i),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isArray=(t=>"[object Array]"===Object.prototype.toString.call(t)),e.isObject=(t=>"[object Object]"===Object.prototype.toString.call(t)),e.isFunction=(t=>"[object Function]"===Function.prototype.toString.call(t)),e.isPromise=(t=>{try{return"function"==typeof t.then}catch(t){return!1}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionInRequest=((t,e)=>{let i=e.request;if(-1!==t.indexOf("/")){t.split("/").map(t=>{i instanceof Function||(i=i[t])})}else i=i[t];if(i instanceof Function)return i})}])});
//# sourceMappingURL=request-model.js.map
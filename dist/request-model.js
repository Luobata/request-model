!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["request-model"]=t():e["request-model"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s(s.s=1)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commitToken=(()=>{const e="__REQUEST__MODEL__COMMIT__TOKEN";return Symbol?Symbol(e):e})()},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(2),r=s.n(i);t.default=r.a},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0),r=s(3);t.default=class{constructor(e){this.requestConfig=e,this.requestFormat()}chain(){return new r.default(this)}commitWrap(e,...t){return{[i.commitToken]:!0,key:e,args:[...t]}}requestFormat(){const e={},t=Object.keys.call(null,this.requestConfig.request),s=Object.keys.call(null,this.requestConfig.modules);for(const s of t)e[s]=this.requestConfig.request[s];for(const t of s){const s={},i=Object.keys.call(null,this.requestConfig.modules[t].request);for(const e of i)s[e]=this.requestConfig.modules[t].request[e];e[t]=s}this.request=e}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0),r=s(4),n=s(5),o=e=>!!r.isObject(e)&&"handler"in e,u=e=>o(e)?e.handler:e,c=(e,t)=>r.isArray(e)?e.filter(e=>!!n.getFunctionInRequest(u(e),t)).length===e.length:!!n.getFunctionInRequest(e,t),l=(e,t,s)=>e.map(e=>n.getFunctionInRequest(u(e),t)(...(e=>o(e)?e.args:[])(e),...s));t.default=class{constructor(e){this.request=e,this.resultList=[],this.waitList=[]}commit(e,...t){if(!c(e,this.request))throw new Error(`can not find matched ${e} function`);if(this.deferItem)this.waitList.push({key:e,args:t});else{let s;if(s=r.isArray(e)?Promise.all(l(e,this.request,[...t])):n.getFunctionInRequest(e,this.request)(...t),!r.isPromise(s))throw new Error(`The ${e} function not return a Promise function`);this.deferItem=s,this.deferItem.then(e=>{this.commitChain(e)},e=>{this.reject&&(this.deferItem=null,this.reject(e))})}return this}then(e,t){return this.waitList.push({resolve:e,reject:t}),this}finish(e,t){return this.resolve=e,this.reject=t,this}catch(e){return this.reject=e,this}commitChain(e){if(this.resultList.push(e),this.waitList.length){const t=this.waitList.shift();this.deferItem=null,"key"in t?this.commit(t.key,...t.args,e):this.innerResolve(t,e)}else this.resolve&&this.resolve(this.resultList)}innerResolve(e,t){const s=e.resolve(t);return r.isPromise(s)?s.then(e=>{this.commitChain(e)},e=>{this.reject&&this.reject(e)}):s[i.commitToken]?this.commit(s.key,...s.args):this.commitChain(s),this}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isArray=(e=>"[object Array]"===Object.prototype.toString.call(e)),t.isObject=(e=>"[object Object]"===Object.prototype.toString.call(e)),t.isFunction=(e=>"[object Function]"===Function.prototype.toString.call(e)),t.isPromise=(e=>{try{return"function"==typeof e.then}catch(e){return!1}})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionInRequest=((e,t)=>{let s=t.request;if(-1!==e.indexOf("/")){e.split("/").map(e=>{s instanceof Function||(s=s[e])})}else s=s[e];if(s instanceof Function)return s})}])});
//# sourceMappingURL=request-model.js.map